version: '0.1.{build}'
configuration:
- Debug
platform: Any CPU
environment:
    DOTNET_CLI_TELEMETRY_OPTOUT: 1
build_script:
- dotnet restore
- dotnet build src\app\project.json
- npm install --prefix ui
- ui\node_modules\.bin\bower install --config.cwd=ui
- ui\node_modules\.bin\typings install --cwd ui
- ui\node_modules\.bin\gulp --cwd ui
test_script:
- dotnet test test\app.tests
- appveyor AddMessage "Dotnet unit tests completed."
- ui\node_modules\.bin\karma start ui\karma.conf.js
- appveyor AddMessage "Typescript/javascript unit tests completed."
after_test:
- nuget install OpenCover /Version=4.6.519 -o .\packages
- nuget install xunit.runner.console /Version=2.2.0-beta2-build3300 -o .\packages
- .\packages\OpenCover.Console.exe -register:user -target:.\packages\xunit.console.clr4.exe "-targetargs:""test\app.tests\bin\Debug\netcoreapp1.0\HelloCoreClrApp.Tests.dll"" /noshadow /appveyor" -filter:"+[HelloCoreClrApp*]*" -output:reports\coverage-dotnet.xml

- npm install codecov remap-istanbul
- node_modules\.bin\remap-istanbul -i reports\coverage-js.json -o reports\coverage-ts.json -t json
- node_modules\.bin\codecov --disable=gvoc -f reports\coverage-ts.json
artifacts:
- path: src\app\bin\Debug\netcoreapp1.0
  name: approot
  type: zip
- path: ui\wwwroot
  name: webroot
  type: zip
cache:
- '%USERPROFILE%\.nuget\packages'
- 'ui\node_modules'
- 'ui\bower_components'
- 'ui\typings'
- 'node_modules'
